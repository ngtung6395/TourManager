CREATE DATABASE TOURMANAGER;
USE TOURMANAGER;

CREATE TABLE THANHPHO(
                         ID INT PRIMARY KEY AUTO_INCREMENT,
                         TEN_THANHPHO VARCHAR(255) NOT NULL UNIQUE
);

INSERT INTO THANHPHO(TEN_THANHPHO) VALUES ('HA NOI'),
                                          ('HA LONG'),
                                          ('HO CHI MINH'),
                                          ('DA NANG'),
                                          ('HUE');

CREATE TABLE DIEMDULICH(
                           ID INT PRIMARY KEY AUTO_INCREMENT,
                           TEN_DIEMDEN VARCHAR(255) NOT NULL UNIQUE ,
                           MOTA VARCHAR(255) NOT NULL,
                           GIATIEN DOUBLE NOT NULL ,
                           ID_THANHPHO INT,
                           FOREIGN KEY (ID_THANHPHO) REFERENCES THANHPHO(ID)
);

INSERT INTO DIEMDULICH(TEN_DIEMDEN, MOTA, GIATIEN, ID_THANHPHO)
VALUES ('NHA TRANG','DIA DIEM THAM QUAN: VINPEARL LAND NHA TRANG', 7000000,1),
       ('DA LAT', 'DIA DIEM THAM QUAN: THANH PHO DAT LAT',8000000,2),
       ('PHU QUOC','DIA DIEM THAM QUAN: DAO PHU QUOC',4500000,4),
       ('HOI AN','DIA DIEM THAM QUAN: BA NA HILL',5000000,3),
       ('CAN THO','DIA DIEM THAM QUAN: THANH PHO CAN THO',4000000,5);

CREATE TABLE KHACHHANG(
                          ID INT PRIMARY KEY AUTO_INCREMENT,
                          HOVATEN VARCHAR(255) NOT NULL ,
                          SO_CCCD VARCHAR(255) NOT NULL UNIQUE ,
                          NAMSINH YEAR,
                          ID_THANHPHO INT,
                          FOREIGN KEY (ID_THANHPHO) REFERENCES THANHPHO(ID)
);

INSERT INTO KHACHHANG(HOVATEN, SO_CCCD, NAMSINH, ID_THANHPHO)
VALUES ('NGUYEN THANH T','001095001081',1995,1),
       ('NGUYEN SON D','001096001084',1994,3),
       ('TRAN PHUONG H','001097360082',1995,4),
       ('LUONG MINH D','001845071438',1995,2),
       ('VU MINH T','001974002003',1995,5),
       ('LE VIET H','100769600016',1995,1),
       ('TRINH TUAN K','100784605016',1995,3),
       ('NGUYEN NAM A','19009607816',1995,2),
       ('VY HUONG GIANG','100769602007',1995,1),
       ('NGUYEN LINH C','100924805016',1995,4);

CREATE TABLE LOAITOUR(
                         ID INT PRIMARY KEY AUTO_INCREMENT,
                         MATOUR VARCHAR(255) NOT NULL ,
                         TENLOAITOUR VARCHAR(255) NOT NULL
);

INSERT INTO LOAITOUR(MATOUR, TENLOAITOUR)
VALUES ('C01','DU LICH NGHI DUONG'),
       ('C02','DU LICH KHAM PHA');

CREATE TABLE TOUR(
                     ID INT PRIMARY KEY AUTO_INCREMENT,
                     MATOUR INT NOT NULL ,
                     LOAITOUR INT,
                     DIEMDEN INT,
                     NGAYBATDAU DATE,
                     NGAYKETTHUC DATE,
                     FOREIGN KEY (LOAITOUR) REFERENCES LOAITOUR(ID),
                     FOREIGN KEY (DIEMDEN) REFERENCES DIEMDULICH(ID)
);

INSERT INTO TOUR(MATOUR, LOAITOUR, DIEMDEN, NGAYBATDAU, NGAYKETTHUC)
VALUES(1,1,1,'2021-03-17','2021-03-20'),
      (2,1,2,'2021-09-29','2021-10-3'),
      (3,1,3,'2021-04-15','2021-04-20'),
      (4,1,4,'2021-03-06','2021-03-13'),
      (5,1,5,'2021-07-15','2021-07-20'),
      (6,2,1,'2021-03-30','2021-04-05'),
      (7,2,2,'2021-02-14','2021-02-18'),
      (8,2,3,'2021-04-30','2021-05-05'),
      (9,2,4,'2021-09-02','2021-09-04'),
      (10,2,5,'2021-01-14','2021-01-22'),
      (11,1,3,'2021-08-08','2021-08-13'),
      (12,2,1,'2021-12-24','2022-01-03'),
      (13,2,4,'2021-03-14','2021-03-16'),
      (14,1,1,'2021-06-01','2021-06-06'),
      (15,1,1,'2021-11-09','2021-11-11');

CREATE TABLE INVOICE(
                        ID INT PRIMARY KEY AUTO_INCREMENT,
                        TOUR_ID INT,
                        KHACHHANG_ID INT,
                        TRANGTHAI BIT DEFAULT 1,
                        FOREIGN KEY (TOUR_ID) REFERENCES TOUR(ID),
                        FOREIGN KEY (KHACHHANG_ID) REFERENCES KHACHHANG(ID)
);

INSERT INTO INVOICE(TOUR_ID, KHACHHANG_ID)
VALUES(1,1),
      (2,3),
      (3,8),
      (9,2),
      (13,4),
      (8,5),
      (11,7),
      (6,6),
      (4,9),
      (5,10);

# THONG KE SO LUONG TOUR CUA CAC THANH PHO

SELECT TEN_DIEMDEN AS 'THANH PHO',COUNT(T.DIEMDEN) AS 'SO LUONG TOUR'
FROM TOUR AS T JOIN DIEMDULICH D on D.ID = T.DIEMDEN
GROUP BY DIEMDEN;

# TINH SO TOUR CO NGAY BAT DAU TRONG THANG 3

SELECT COUNT(NGAYBATDAU) AS 'SO LUONG TOUR BAT DAU THANG 3'
FROM TOUR WHERE MONTH(NGAYBATDAU) = 3;

# TINH SO TOUR CO NGAY KET THUC TRONG THANG 4

SELECT COUNT(NGAYKETTHUC) AS 'SO LUONG TOUR KET THUC THANG 4'
FROM TOUR WHERE MONTH(NGAYKETTHUC) = 4;